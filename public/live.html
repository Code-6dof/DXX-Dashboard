<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DXX Tracker — Game Archive</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/live.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body class="live-tracker-body">
  <!-- ───── Navigation ───── -->
  <nav class="main-nav">
    <div class="nav-inner">
      <div class="nav-logo">
        <img src="images/Extralife.gif" alt="DXX" class="logo-icon" style="height: 32px; width: auto;" />
        <span>DXX Tracker</span>
      </div>
      <div class="nav-center" id="modeTabs">
        <button class="tab active" data-mode="all">All Games</button>
        <button class="tab" data-mode="1v1">1v1 Duels</button>
        <button class="tab" data-mode="ffa">Free-For-All</button>
      </div>
      <div class="nav-links">
        <a href="index.html" class="nav-link">Live Games</a>
        <a href="live.html" class="nav-link active">Game Archive</a>
      </div>
    </div>
  </nav>

  <!-- ───── All Games Table View ───── -->
  <section class="view-section" id="allView">
    <!-- Charts -->
    <div id="chartsContainer" class="charts-container" style="display: none; margin-bottom: 2rem;">
      <div class="chart-card">
        <h3>Games Over Time (2014-2026)</h3>
        <canvas id="gamesOverTimeChart"></canvas>
      </div>
      <div class="chart-card">
        <h3>Game Mode Distribution</h3>
        <canvas id="modeDistChart"></canvas>
      </div>
      <div class="chart-card wide">
        <h3>Top 30 Players by Total Kills</h3>
        <canvas id="topPlayersChart"></canvas>
      </div>
      <div class="chart-card wide">
        <h3>Top 20 Most Played Maps</h3>
        <canvas id="topMapsChart"></canvas>
      </div>
      <div class="chart-card">
        <h3>Games by Day of Week</h3>
        <canvas id="dayOfWeekChart"></canvas>
      </div>
    </div>
    
    <div class="table-wrap">
      <div class="table-filters" id="filtersSection">
        <input type="text" id="searchInput" placeholder="Search player or map..." autocomplete="off" />
        <select id="yearFilter"><option value="">All Years</option></select>
        <select id="monthFilter"><option value="">All Months</option></select>
        <select id="mapFilter"><option value="">All Maps</option></select>
        <select id="versionFilter">
          <option value="">All Versions</option>
          <option value="D1">Descent 1</option>
          <option value="D2">Descent 2</option>
        </select>
        <button id="applyFilters" class="btn-primary" style="display: none;">Apply</button>
        <button id="clearFilters" class="btn-secondary" style="display: none;">Clear</button>
        <button class="btn-secondary" id="toggleCharts" style="display: none;">Show Charts</button>
        <span id="filterPlaceholderText" style="color: var(--text-dim); font-size: 0.9rem;"></span>
      </div>
      <table id="gamesTable">
        <thead>
          <tr>
            <th data-sort="timestamp" class="sortable active-sort">Date ▼</th>
            <th>Map</th>
            <th>Mode</th>
            <th>Version</th>
            <th>Players</th>
            <th>Duration</th>
            <th>Winner</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody id="gamesBody"></tbody>
      </table>
    </div>
    <div class="pagination" id="pagination"></div>
    <div style="text-align: center; margin: 2rem 0;">
      <button id="loadAllBtn" class="btn-load-all">Load Full Game Archive</button>
      <div style="font-size: 0.85rem; color: var(--text-dim); margin-top: 0.5rem;">
      </div>
    </div>
  </section>

  <!-- ───── 1v1 Duel View ───── -->
  <section class="view-section" id="duelView" style="display:none;">
    <h2>1v1 Duels</h2>
    <p class="view-desc">Head-to-head combat — two pilots, one winner.</p>
    <div class="duel-list" id="duelList"></div>
    <div class="pagination" id="duelPagination"></div>
  </section>

  <!-- ───── FFA View ───── -->
  <section class="view-section" id="ffaView" style="display:none;">
    <h2>Free-For-All Matches</h2>
    <p class="view-desc">Multi-pilot chaos — last one standing takes the glory.</p>
    <div class="ffa-list" id="ffaList"></div>
    <div class="pagination" id="ffaPagination"></div>
  </section>

  <!-- ───── Load All Confirmation Modal ───── -->
  <div class="confirm-modal" id="loadAllModal">
    <div class="modal-backdrop"></div>
    <div class="modal-dialog">
      <div class="modal-content">
        <h3>⚠️ Load Full Archive</h3>
        <p>You're about to load <strong>all 61,000+ games</strong> from the archive.</p>
        <p>This will download approximately <strong>44 MB</strong> of data and may take <strong>10-30 seconds</strong> depending on your connection speed.</p>
        <p style="color: var(--text-dim); font-size: 0.9rem; margin-top: 1rem;">Once loaded, all filtering will be instant. Your browser will cache the data for the current session.</p>
        <div class="modal-actions">
          <button id="confirmLoadAll" class="btn-primary">Load All Games</button>
          <button id="cancelLoadAll" class="btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ───── Game Detail Modal ───── -->
  <div class="game-detail-modal" id="gameDetailModal">
    <div class="gdm-backdrop"></div>
    <div class="gdm-dialog">
      <div class="gdm-content" id="gameDetailContent"></div>
    </div>
  </div>

  <!-- ───── Loading Overlay ───── -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p id="loadingText">Loading Dashboard...</p>
    <small id="loadingProgress" style="color: var(--text-dim); margin-top: 0.5rem;"></small>
  </div>

  <!-- ───── Footer ───── -->
  <footer>
    <p>Some Data sourced from <a href="https://retro-tracker.game-server.cc/archive/full.html" target="_blank">Retro Tracker</a> by Arch/PuDLeZ. DXX Tracker Hosted/Created by Code</p>
  </footer>

  <script src="js/charts.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/game-detail.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
